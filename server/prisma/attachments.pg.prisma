generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/attachments-pg-client"
}

datasource db {
  provider = "postgresql"
  url      = env("ATTACHMENTS_DATABASE_URL_PG")
}

model Attachment {
  id             String   @id @default(uuid())
  businessCode   String
  customerId     String
  customerName   String
  fileName       String
  originalName   String
  fileSize       Int
  mimeType       String
  fileHash       String
  storageType    String
  storagePath    String
  storageServer  String?
  category       String?
  billOfLading   String?
  uploadedAt     DateTime @default(now())
  uploadedBy     String?
  archivedAt     DateTime?
  lastAccessedAt DateTime?
  description    String?
  tags           String?

  @@index([businessCode])
  @@index([customerId])
  @@index([billOfLading])
  @@index([uploadedAt])
  @@index([fileHash])
}

model AttachmentAccessLog {
  id           String   @id @default(uuid())
  attachmentId String
  accessedAt   DateTime @default(now())
  accessedBy   String?
  accessType   String
  ipAddress    String?

  @@index([attachmentId])
  @@index([accessedAt])
}

model ColdStorageMigration {
  id              String   @id @default(uuid())
  batchId         String   @unique
  attachmentCount Int
  totalSize       Int
  startDate       DateTime
  endDate         DateTime
  migratedAt      DateTime @default(now())
  migratedBy      String
  status          String
  errorMessage    String?

  @@index([batchId])
  @@index([migratedAt])
  @@index([status])
}
